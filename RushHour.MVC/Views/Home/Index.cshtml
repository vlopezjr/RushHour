@model IList<RushHour.Models.Entities.Customer>
@{
    ViewBag.Title = "Home Page";
}
<p>
    @*@foreach (RushHour.Models.Entities.Customer cust in Model)
    {
        <div>@cust.Name</div>
    }*@
</p>

<form id="custForm" class="needs-validation" novalidate>
    <div class="form-group ui-widget">
        <div class="row">
            <div class="col-md-3">
                <label for="inCustomer" class="font-weight-bold">Customer</label>
                <select class="form-control custom-select" id="inCustomer" required>
                    <option value="">Choose...</option>
                    <option value="1">Best Brakes</option>
                    <option value="2">Home Depot</option>
                    <option value="3">Amazon</option>

                </select>
                @*<div class="invalid-feedback">
                    Please provide a valid Customer.
                </div>*@
            </div>

            <div class="col-md-3">
                <label for="inDriver" class="font-weight-bold">Driver</label>
                <select class="form-control custom-select" id="inDriver" required>
                    <option value="">Choose...</option>
                    <option value="1">Johnny</option>
                    <option value="2">Jacob</option>
                    <option value="3">Andre</option>

                </select>
                @*<div class="invalid-feedback">
                    Please provide a valid Driver.
                </div>*@
            </div>

            <div class="col-md-2">
                <label for="inAccountNumber" class="font-weight-bold">Acct#</label>
                <input type="text" id="inAccountNumber" class="form-control" placeholder="Acct #" required />
                @*<div class="invalid-feedback">
                    Please provide a valid Accout Number.
                </div>*@
            </div>
            <div class="col-md-2">
                <label for="inRefNumber" class="font-weight-bold">Ref No</label>
                <input type="text" id="inReferenceNumber" class="form-control" placeholder="Acct #" required/>
                @*<div class="invalid-feedback">
                    Please provide a valid Ref Number.
                </div>*@
            </div>
            <div class="col-md-2">
                <label for="inDate" class="font-weight-bold">Date</label>
                <input type="date" class="form-control" id="inDeliveryDate" required/>
                @*<div class="invalid-feedback">
                    Please provide a date.
                </div>*@
            </div>
        </div>
    </div>
    <div class="form-group">
        <div class="row">
            <div class="col-md-6">
                <label for="inPickupAddress" class="font-weight-bold">Pick Up Address</label>
                <select class="form-control custom-select" id="inPickupAddress" required>
                    <option value="">Choose...</option>
                    <option value="10">Corporate Office, Ontario</option>
                    <option value="11">Chino Warehouse, Chino</option>
                    <option value="12">LA Office, Los Angeles</option>

                </select>
                @*<div class="invalid-feedback">
                    Please provide a valid Pick Up Address.
                </div>*@
            </div>

            <div class="col-md-6">
                <label for="inDeliverToAddress" class="font-weight-bold">Deliver To Address</label>
                <select class="form-control custom-select" id="inDeliverToAddress" required>
                    <option value="">Choose...</option>
                    <option value="10">Corporate Office, Ontario</option>
                    <option value="11">Chino Warehouse, Chino</option>
                    <option value="12">LA Office, Los Angeles</option>

                </select>
                @*<div class="invalid-feedback">
                    Please provide a valid Deliver To Address.
                </div>*@
            </div>
        </div>
    </div>

    <div class="form-group">
        <div class="row">
            <div class="col">
                <input type="text" class="form-control" placeholder="Address" readonly>
            </div>
            <div class="col">
                <input type="text" class="form-control" placeholder="Address" readonly>
            </div>
        </div>
    </div>

    <div class="form-group">
        <div class="row">
            <div class="col-md-3">

                <input type="text" class="form-control" id="inputCity" placeholder="City" readonly>

            </div>
            <div class="col-md-2 pl-0">

                <select class="form-control" id="inputState" readonly>
                    <option>State...</option>
                    <option value="AL">Alabama</option>
                    <option value="AK">Alaska</option>
                    <option value="AZ">Arizona</option>
                    <option value="AR">Arkansas</option>
                    <option value="CA">California</option>
                    <option value="CO">Colorado</option>
                    <option value="CT">Connecticut</option>
                    <option value="DE">Delaware</option>
                    <option value="DC">District Of Columbia</option>
                    <option value="FL">Florida</option>
                    <option value="GA">Georgia</option>
                    <option value="HI">Hawaii</option>
                    <option value="ID">Idaho</option>
                    <option value="IL">Illinois</option>
                    <option value="IN">Indiana</option>
                    <option value="IA">Iowa</option>
                    <option value="KS">Kansas</option>
                    <option value="KY">Kentucky</option>
                    <option value="LA">Louisiana</option>
                    <option value="ME">Maine</option>
                    <option value="MD">Maryland</option>
                    <option value="MA">Massachusetts</option>
                    <option value="MI">Michigan</option>
                    <option value="MN">Minnesota</option>
                    <option value="MS">Mississippi</option>
                    <option value="MO">Missouri</option>
                    <option value="MT">Montana</option>
                    <option value="NE">Nebraska</option>
                    <option value="NV">Nevada</option>
                    <option value="NH">New Hampshire</option>
                    <option value="NJ">New Jersey</option>
                    <option value="NM">New Mexico</option>
                    <option value="NY">New York</option>
                    <option value="NC">North Carolina</option>
                    <option value="ND">North Dakota</option>
                    <option value="OH">Ohio</option>
                    <option value="OK">Oklahoma</option>
                    <option value="OR">Oregon</option>
                    <option value="PA">Pennsylvania</option>
                    <option value="RI">Rhode Island</option>
                    <option value="SC">South Carolina</option>
                    <option value="SD">South Dakota</option>
                    <option value="TN">Tennessee</option>
                    <option value="TX">Texas</option>
                    <option value="UT">Utah</option>
                    <option value="VT">Vermont</option>
                    <option value="VA">Virginia</option>
                    <option value="WA">Washington</option>
                    <option value="WV">West Virginia</option>
                    <option value="WI">Wisconsin</option>
                    <option value="WY">Wyoming</option>
                </select>
                @*<div class="invalid-feedback">
                    Please provide a valid state.
                </div>*@
            </div>
            <div class="col-md-1 pl-0">

                <input type="text" class="form-control" id="inputZip" placeholder="Zip" readonly>
                @*<div class="invalid-feedback">
                    Zip code required.
                </div>*@
            </div>

            <div class="col-md-3">

                <input type="text" class="form-control" id="inputCity" placeholder="City" readonly>

            </div>
            <div class="col-md-2 pl-0">

                <select class="form-control" id="inputState" readonly>
                    <option>State...</option>
                    <option value="AL">Alabama</option>
                    <option value="AK">Alaska</option>
                    <option value="AZ">Arizona</option>
                    <option value="AR">Arkansas</option>
                    <option value="CA">California</option>
                    <option value="CO">Colorado</option>
                    <option value="CT">Connecticut</option>
                    <option value="DE">Delaware</option>
                    <option value="DC">District Of Columbia</option>
                    <option value="FL">Florida</option>
                    <option value="GA">Georgia</option>
                    <option value="HI">Hawaii</option>
                    <option value="ID">Idaho</option>
                    <option value="IL">Illinois</option>
                    <option value="IN">Indiana</option>
                    <option value="IA">Iowa</option>
                    <option value="KS">Kansas</option>
                    <option value="KY">Kentucky</option>
                    <option value="LA">Louisiana</option>
                    <option value="ME">Maine</option>
                    <option value="MD">Maryland</option>
                    <option value="MA">Massachusetts</option>
                    <option value="MI">Michigan</option>
                    <option value="MN">Minnesota</option>
                    <option value="MS">Mississippi</option>
                    <option value="MO">Missouri</option>
                    <option value="MT">Montana</option>
                    <option value="NE">Nebraska</option>
                    <option value="NV">Nevada</option>
                    <option value="NH">New Hampshire</option>
                    <option value="NJ">New Jersey</option>
                    <option value="NM">New Mexico</option>
                    <option value="NY">New York</option>
                    <option value="NC">North Carolina</option>
                    <option value="ND">North Dakota</option>
                    <option value="OH">Ohio</option>
                    <option value="OK">Oklahoma</option>
                    <option value="OR">Oregon</option>
                    <option value="PA">Pennsylvania</option>
                    <option value="RI">Rhode Island</option>
                    <option value="SC">South Carolina</option>
                    <option value="SD">South Dakota</option>
                    <option value="TN">Tennessee</option>
                    <option value="TX">Texas</option>
                    <option value="UT">Utah</option>
                    <option value="VT">Vermont</option>
                    <option value="VA">Virginia</option>
                    <option value="WA">Washington</option>
                    <option value="WV">West Virginia</option>
                    <option value="WI">Wisconsin</option>
                    <option value="WY">Wyoming</option>
                </select>
                @*<div class="invalid-feedback">
                    Please provide a valid state.
                </div>*@
            </div>
            <div class="col-md-1 pl-0">

                <input type="text" class="form-control" id="inputZip" placeholder="Zip" readonly>
                @*<div class="invalid-feedback">
                    Zip code required.
                </div>*@
            </div>
        </div>
    </div>

    <p class="font-weight-bold">Packages</p>

    <table id="freightTable" class="table table-sm table-dark">
        <thead>
            <tr>
                <th scope="col" class="w-25">Type</th>
                <th scope="col">Qty</th>
                <th scope="col">Weight</th>
                <th scope="col" class="w-50">Description</th>
                <th scope="col"></th>
            </tr>
        </thead>
        <tbody id="freightBody">
            <tr class="table-light h-75">
                <td>
                    <select class="form-control" id="inFreightType">
                        <option>Choose...</option>
                        <option value="1">Pallet</option>
                        <option value="2">Box</option>
                        <option value="3">Envelope</option>

                    </select>
                </td>
                <td>
                    <input type="text" class="form-control" id="inFreightQty" placeholder="Qty" />
                </td>
                <td>
                    <input type="text" class="form-control" id="inFreightWeight" placeholder="Weight" />
                </td>
                <td>
                    <input type="text" class="form-control" id="inFreightDescription" placeholder="Description" />
                </td>
                <td>
                    <button class="btn btn-sm" id="inAddFreight"><i class='fa fa-plus fa-sm'></i></button>
                </td>
            </tr>


        </tbody>
    </table>

    <div class="form-group form-row">

        <div class="input-group col-md-4">
            <div class="input-group-prepend">
                <span class="input-group-text">Arrival Time</span>
            </div>
            <input type="time" id="inArrivalTime" class="form-control">
            
        </div>

        <div class="input-group col-md-4">
            <div class="input-group-prepend">
                <span class="input-group-text">Departure Time</span>
            </div>
            <input type="time" id="inDepartureTime" class="form-control">

        </div>

        <div class="input-group col-md-4">
            <div class="input-group-prepend">
                <span class="input-group-text">Delivery Time</span>
            </div>
            <input type="time" id="inDeliveryTime" class="form-control" >

        </div>
    </div>

        <div class="form-group row">
            <div class="col-md-2">
                <label for="inDeliveryCharge">Delivery Charge</label>
                <div class="input-group">

                    <div class="input-group-prepend">
                        <span class="input-group-text">$</span>
                    </div>
                    <input type="text" id="inDeliveryCharge" class="form-control" placeholder="Delivery" required>
                    @*<div class="invalid-feedback">
                        Please provide a Delivery Charge.
                    </div>*@
                </div>
            </div>

            <div class="col-md-2">
                <label for="inWeekendCharge">Weekend Charge</label>
                <div class="input-group">

                    <div class="input-group-prepend">
                        <span class="input-group-text">$</span>
                    </div>
                    <input type="text" id="inWeekendCharge" class="form-control" placeholder="Weekend">

                </div>
            </div>

            <div class="col-md-2">
                <label for="inReturnCharge">Return Charge</label>
                <div class="input-group">

                    <div class="input-group-prepend">
                        <span class="input-group-text">$</span>
                    </div>
                    <input type="text" id="inReturnCharge" class="form-control" placeholder="Return">

                </div>
            </div>

            <div class="col-md-2">
                <label for="inWaitingCharge">Waiting Charge</label>
                <div class="input-group">

                    <div class="input-group-prepend">
                        <span class="input-group-text">$</span>
                    </div>
                    <input type="text" id="inWaitingCharge" class="form-control" placeholder="Waiting">

                </div>
            </div>

            <div class="col-md-2">
                <label for="inCODCharge">C.O.D. Charge</label>
                <div class="input-group">

                    <div class="input-group-prepend">
                        <span class="input-group-text">$</span>
                    </div>
                    <input type="text" id="inCODCharge" class="form-control" placeholder="COD">

                </div>
            </div>

            <div class="col-md-2">
                <label for="inTotalCharge">Total Charge</label>
                <div class="input-group">

                    <div class="input-group-prepend">
                        <span class="input-group-text">$</span>
                    </div>
                    <input type="text" id="inTotalCharge" class="form-control" placeholder="Total Charge" required>
                    @*<div class="invalid-feedback">
                        Please provide a Total Charge.
                    </div>*@
                </div>
            </div>
        </div>

        <button class="btn btn-primary" id="inputSubmit" type="submit">Submit Manifest</button>
</form>

@section scripts
{
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        AddDefaults();
        AddPackages();

        $("#inAddFreight").click(function (event) {
            event.preventDefault();

            var id = $("#freightTable").find("tr").length + 1;
            var type = $("#inFreightType").val();
            var typeText = $("#inFreightType option:selected").text();
            var qty = $("#inFreightQty").val();
            var weight = $("#inFreightWeight").val();
            var descr = $("#inFreightDescription").val();


            qty = Math.floor((Math.random() * 10) + 1);
            weight = Math.floor((Math.random() * 1000) + 100);
            descr = qty + " " + typeText + "(s) weighing " + weight + " lbs.";

            console.log("type: " + type + " text: " + typeText + " qty: " + qty + " weight: " + weight + " descr: " + descr);
            var freightBody = $("#freightBody");
            freightBody.append("<tr id='row" + id + "' class='bg-info freightRow h-100'><td data-freightType='" + type +"'>" + typeText + "</td><td>" + qty + "</td><td>" + weight + "</td><td>" + descr + "</td><td><button class='freightRemove btn btn-sm' id='btn" + id + "'><i class='fa fa-minus fa-sm'></i></button></td></tr>");

            $("#inFreightType").val("");
            $("#inFreightQty").val("");
            $("#inFreightWeight").val("");
            $("#inFreightDescription").val("");

            //alert("Add Freight");
        });

        $(document).on('click', '#inputSubmit', function (event) {
            event.preventDefault();

            // Fetch form to apply custom Bootstrap validation
            var form = $("#custForm");

            if (form[0].checkValidity() === false) {
                event.preventDefault();
                event.stopPropagation();
            }

            form.addClass('was-validated');

            var freightArray = new Array();         
            $('.freightRow').each(function () {

                var freightType = $(this).find('td:eq(0)').attr('data-freightType');
                var freightTypeText = $(this).find('td:eq(0)').html();
                var freightQty = $(this).find('td:eq(1)').html().trim();
                var freightWeight = $(this).find('td:eq(2)').html().trim();
                var freightDescr = $(this).find('td:eq(3)').html().trim();

                console.log("Freight Row: " + freightType + ", " + freightTypeText + ", " + freightQty + ", " + freightWeight + ", " + freightDescr);

                var freight = {
                    type: freightType,
                    quantity: freightQty,
                    weight: freightWeight,
                    description: freightDescr
                };                    
                
                freightArray.push(freight);
            });

            var delivery = {
                customerId: $("#inCustomer").val(),
                driverId: $("#inDriver").val(),
                CustomerRefNo: $("#inAccountNumber").val().trim(),
                RefNo: $("#inReferenceNumber").val().trim(),
                deliveryDate: $("#inDeliveryDate").val(),
                pickupAddressId: $("#inPickupAddress").val(),
                deliverToAddressId: $("#inDeliverToAddress").val(),
                arrivalTime: $("#inArrivalTime").val(),
                departureTime: $("#inDepartureTime").val(),
                deliveryTime: $("#inDeliveryTime").val(),
                deliveryCharge: $("#inDeliveryCharge").val(),
                weekendCharge: $("#inWeekendCharge").val(),
                returnCharge: $("#inReturnCharge").val(),
                waitingCharge: $("#inWaitingCharge").val(),
                codCharge: $("#inCODCharge").val(),
                totalCharge: $("#inTotalCharge").val(),
                freights: freightArray
            };

            console.log(delivery);
            $.ajax({
                type: "POST",
                data: JSON.stringify(delivery),
                url: "/Home/AddDelivery",
                contentType: "application/json"
            });


        });

        $("#freightTable").on('click', 'tr .freightRemove', function () {
            $(this).closest('td').parent().empty();
        });

        function GetDate() {
            var now = new Date();

            var day = ("0" + now.getDate()).slice(-2);
            var month = ("0" + (now.getMonth() + 1)).slice(-2);

            var today = now.getFullYear() + "-" + (month) + "-" + (day);

            return today;
        }

        function AddDefaults() {           

            $("#inCustomer").val("2");
            $("#inDriver").val("1");
            $("#inAccountNumber").val("12345");
            $("#inReferenceNumber").val("23506");
            $("#inDeliveryDate").val(GetDate());
            $("#inPickupAddress").val("10");
            $("#inDeliverToAddress").val("11");
            //    arrivalTime: $("#inArrivalTime").val(),
            //    departureTime: $("#inDepartureTime").val(),
            //    deliveryTime: $("#inDeliveryTime").val(),
            $("#inDeliveryCharge").val("14.25");
            //    weekendCharge: $("#inWeekendCharge").val(),
            //    returnCharge: $("#inReturnCharge").val(),
            //    waitingCharge: $("#inWaitingCharge").val(),
            //    codCharge: $("#inCODCharge").val(),
            $("#inTotalCharge").val("15.25");
        }

        function AddPackages() {
            var id = $("#freightTable").find("tr").length + 1;
            var freightBody = $("#freightBody");

            var i;
            for (i = id; i < 5; i++) {
                var qty = i + 1;
                var weight = 100 + (i * 10);
                var descr = qty + " boxes";

                freightBody.append("<tr id='row" + i + "' class='bg-info freightRow h-100'><td data-freightType='2'>Box</td><td>" + qty + "</td><td>" + weight + "</td><td>" + descr + "</td><td><button class='freightRemove btn btn-sm' id='btn" + id + "'><i class='fa fa-minus fa-sm'></i></button></td></tr>");
            }
        }
    });
</script>   
    
}